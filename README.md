# Проектная работа "Веб-ларёк"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Данные и типы данных, используемые в приложении

Продукт

```typescript
interface IProductItem {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null;
}
```

Корзина

```typescript
interface IBasket {
	items: string[];
	total: number;
}
```

Метод оплаты

```typescript
type PaymentMethod = 'cash' | 'card'
```

Заказ

```typescript
interface IOrder {
	payment: PaymentMethod;
	email: string;
	phone: string;
	address: string;
	total: number;
	items: string[];
	id: string;
}
```

Список товаров на главной странице

```typescript
interface IProductsData {
	items: 	IProductItem[];
	preview: string | null;
	getProduct(productId: string): IProductItem;
}
```

Корзина и заказ

```typescript
interface IOrderData {
	basket: IBasket;
	order: TOrder;
	isInBasket(item: IProductItem): IProductItem;
	addToBasket(item: IProductItem): void;
	removeFromBasket(item: IProductItem): void;
	clearBasket(): void;
	setOrderPayment(method: PaymentMethod): void;
	clearOrder(): void;
	checkPaymentValidation(data: Record<keyof TPaymentForm, string>): boolean;
	checkContactValidation(data: Record<keyof TContactForm, string>): boolean;
}
```

Заказ

```typescript
export type TOrder = Omit<IOrder, 'id' | 'items' | 'total'>;
```

Результат покупки

```typescript
type TOrderResult = Pick<IOrder, 'id' | 'total'>;
```

Форма выбора способа оплаты и ввода адреса доставки

```typescript
type TPaymentForm = Pick<IOrder, 'payment' | 'address'>;
```

Форма ввода адреса эл.почты и номера телефона

```typescript
type TContactForm = Pick<IOrder, 'email' | 'phone'>;
```

## Архитектура приложения

Код приложения разделён на слои согласно парадигме MVP:
- слой данных: отвечает за хранение и изменения данных;
- слой представления: отвечает за отображение данных на странице;
- презентер: отвечает за связь данных и представления.

### Базовый код

#### Класс `Api`

Базовый класс для отправки и получения запросов.

Конструктор принимает такие аргументы:
1. `baseUrl: string` - базовый адрес сервера
2. `options: RequestInit = {}` - объект с заголовками запросов

Класс имеет такие методы:
- `handleResponse(response: Response): Promise<object>` - для обработки ответов сервера;
- `get(uri: string)`,  `post(uri: string, data: object, method: ApiPostMethods = 'POST')` - для отправки и получения запросов к серверу.

#### Класс `EventEmitter`

Брокер событий. Реализует паттерн "Наблюдатель" и позволяет подписываться на события и уведомлять подписчиков о наступлении события.

Класс имеет такие методы:
- `on`, `off`, `emit` - для подписки на событие, отписки от события, уведомления подписчиков о наступлении события;
- `onAll`, `offAll` - для подписки на все события и сборс всех подписчиков;
- `trigger` - генерирует заданное событие с заданными аргументами, что позволяет передавать его в качестве обработчика события в другие классы.

### Слой данных

#### Класс ProductsData
Класс отвечает за хранение и логику работы с данными товаров.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `items: IProductItem[]` - массив объектов товаров;
- `preview: string | null` - id товара, выбранного для просмотра в модальном окне;

Класс предоставляет набор методов для взаимодействия с этими данными:

- `getProduct(productId: string): IProductItem` - возвращает id товара;


#### Класс OrderData
Класс отвечает за хранение и логику работы с данными корзины и заказа.\
Конструктор класса принимает инстант брокера событий.\
В полях класса хранятся следующие данные:
- `basket: IBasket` - корзина;
- `order: TOrder` - платежная и контактная часть заказа (без id, items, total);

Класс предоставляет набор методов для взаимодействия с этими данными:

- `isInBasket(item: IProductItem): boolean` - для проверки есть ли товар в корзине;
- `addToBasket(item: IProductItem): void` - добавляет товар в корзину;
- `removeFromBasket(item: IProductItem): void` - удаляет товар из корзины;
- `clearBasket(): void` - очищает корзину;
- `createOrderToPost(): IOrder` - создаёт полный заказ для отправки на сервер (берёт данные из basket и order);
- `setOrderField(): void` - устанавливает поле формы;
- `clearOrder(): void` - очищает заказ;
- `checkFormFieldValidation(): boolean` - проверяет данные поля формы после ввода на валидность;

### Слой представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Modal
Реализует модальное окно. Так же предоставляет методы `open` и `close` для управления отображением модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
- constructor(selector: string, events: IEvents) Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса `EventEmitter` для возможности инициации событий.
Конструктор класса принимает инстант брокера событий\
Поля класса
- modal: HTMLElement - элемент модального окна
- events: IEvents - брокер событий

#### Класс ModalWithForm
Расширяет класс Modal. Предназначен для реализации модального окна с формами содержащими поля ввода.\
При сабмите инициирует событие, передаёт в него объект с данными из полей ввода формы. При изменении данных в полях ввода инициирует событие изменения данных. Предоставляет методы для отображения ошибок и управления активностью кнопки сохранения.

Поля класса:
- `submitButton: HTMLButtonElement` - Кнопка подтверждения формы
- `_form: HTMLFormElement` - элемент формы
- `formName: string `- значение атрибута name формы
- `inputs: NodeListOf<HTMLInputElement>` - коллекция всех полей ввода формы
- `errors: Record<string, HTMLElement> `- объект хранящий все элементы для вывода ошибок под полями формы с привязкой к атрибуту name инпутов

Методы:
- `setValid(isValid: boolean): void `- изменяет активность кнопки подтверждения
- `getInputValues(): Record<string, string>` - возвращает объект с данными из полей формы, где ключ - name инпута, значение - данные введенные пользователем
- `setInputValues(data: Record<string, string>): void `- принимает объект с данными для заполнения полей формы
- `setError(data: { field: string, value: string, validInformation: string }): void `- принимает объект с данными для отображения или сокрытия текстов ошибок под полями ввода
- `showInputError (field: string, errorMessage: string): void` - отображает полученный текст ошибки под указанным полем ввода
- `hideInputError (field: string): void` - очищает текст ошибки под указанным полем ввода
- `close (): void` - расширяет родительский метод дополнительно при закрытии очищая поля формы и деактивируя кнопку сохранения
- `get form: HTMLElement` - геттер для получения элемента формы


#### Класс Card
Отвечает за отображение карточки, задавая в карточке данные названия, изображения, количества лайков, наличия лайка текущего пользователя. Класс используется для отображения карточек на странице сайта. В конструктор класса передается DOM элемент темплейта, что позволяет при необходимости формировать карточки разных вариантов верстки. В классе устанавливаются слушатели на все интерактивные элементы, в результате взаимодействия с которыми пользователя генерируются соответствующие события.\
Поля класса содержат элементы разметки элементов карточки. Конструктор, кроме темплейта принимает экземпляр `EventEmitter` для инициации событий.\
Методы:
- render(cardData: Partial<ICard>, userId: string): HTMLElement - заполняет атрибуты элементов карточки данными, а так-же управляет отображением корзины удаления на основании данных о текущем пользователе. Корзина удаления будет отображаться только если создатель карточки текущий пользователь. Метод возвращает разметку карточки с установленными слушателями. Слушатели устанавливаются на все интерактивные элементы карточки и генерируют соответствующие события через экземпляр брокера событий.
- isLiked(): boolean - метод возвращает наличие на карточке лайка текущего пользователя
- deleteCard(): void - метод для удаления разметки карточки
- геттер _id возвращает уникальный id карточки

#### Класс CardsContainer
Отвечает за отображение блока с карточками на главной странице. Предоставляет метод `addCard(cardElement: HTMLElement)` для добавления карточек на страницу и сеттер `container` для полного обновления содержимого. В конструктор принимает контейнер, в котором размещаются карточки.

### Слой коммуникации

#### Класс AppApi
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.
